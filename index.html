<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Office Task Tracker</title>

    <style>
      body {
        font-family: Arial, sans-serif;
        max-width: 1100px;
        margin: 30px auto;
        padding: 20px;
        border: 1px solid #ddd;
        border-radius: 10px;
        background-color: #fafafa;
      }
      h1 {
        text-align: center;
        color: #2c3e50;
      }

      form {
        display: grid;
        grid-template-columns: repeat(6, 1fr);
        gap: 10px;
        align-items: end;
        margin-bottom: 25px;
      }

      label {
        font-weight: bold;
        font-size: 13px;
        margin-bottom: 4px;
      }

      input,
      select,
      button {
        padding: 8px;
        border-radius: 5px;
        width: 100%;
        border: 1px solid #ccc;
        font-size: 14px;
      }

      button {
        background-color: #3498db;
        color: white;
        font-weight: bold;
      }

      .filters {
        display: flex;
        gap: 10px;
        margin-bottom: 15px;
        justify-content: space-between;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 20px;
      }
      th,
      td {
        padding: 10px;
        border: 1px solid #ddd;
      }
      th {
        background-color: #3498db;
        color: white;
      }

      tr.status-completed {
        background-color: #c8f7c5 !important;
      }
      tr.status-delayed {
        background-color: #f8d7da !important;
      }
      tr.status-inprogress {
        background-color: #fff8cd !important;
      }
      tr.status-cancelled {
        background-color: #e0e0e0 !important;
      }
    </style>
  </head>
  <body>
    <h1>Office Task Tracker</h1>

    <!-- Filters -->
    <div class="filters">
      <div>
        <label>Filter by Assigned To:</label>
        <select id="filterAssigned">
          <option value="">All</option>
          <option value="Dennis Ebora">Dennis Ebora</option>
          <option value="Van Lagaras">Van Lagaras</option>
          <option value="Van/Dennis">Van/Dennis</option>
          <option value="Edmar Padayhag">Edmar Padayhag</option>
        </select>
      </div>

      <div>
        <label>Filter by Status:</label>
        <select id="filterStatus">
          <option value="">All</option>
          <option value="In Progress">In Progress</option>
          <option value="Completed">Completed</option>
          <option value="Delayed">Delayed</option>
          <option value="Cancelled">Cancelled</option>
        </select>
      </div>

      <div>
        <label>Search Task:</label>
        <input
          type="text"
          id="searchInput"
          placeholder="Search by task or remark"
        />
      </div>
    </div>

    <!-- Form -->
    <form id="taskForm">
      <div>
        <label for="assignedTo">Assigned To</label>
        <select id="assignedTo" name="assignedTo">
          <option value="Dennis Ebora">Dennis Ebora</option>
          <option value="Van Lagaras">Van Lagaras</option>
          <option value="Van/Dennis">Van/Dennis</option>
          <option value="Edmar Padayhag">Edmar Padayhag</option>
        </select>
      </div>

      <div>
        <label for="task">Task</label>
        <input type="text" id="task" required />
      </div>

      <div>
        <label for="startDate">Start Date</label>
        <input type="date" id="startDate" required />
      </div>

      <div>
        <label for="dueDate">Due Date</label>
        <input type="date" id="dueDate" required />
      </div>

      <div>
        <label for="status">Status</label>
        <select id="status">
          <option value="In Progress">In Progress</option>
          <option value="Completed">Completed</option>
          <option value="Delayed">Delayed</option>
          <option value="Cancelled">Cancelled</option>
        </select>
      </div>

      <input type="text" id="remarks" placeholder="Remarks" />
      <button type="submit">Add Task</button>
    </form>

    <h2>Task List</h2>

    <table id="taskTable">
      <thead>
        <tr>
          <th>Assigned To</th>
          <th>Task</th>
          <th>Start Date</th>
          <th>Due Date</th>
          <th>Status</th>
          <th>Remarks</th>
          <th>Completed Date</th>
          <th>Actions</th>
        </tr>
      </thead>
      <tbody></tbody>
    </table>

    <script>
      const API_URL =
        "https://script.google.com/macros/s/AKfycby-PjbMsCxj0t3ONVmV7yE_Tq9NZG08YgBUbZ7qy6EK4MPipCLRi8v22t5h6LEHo6LH/exec";
      let editIndex = null;

      async function loadTasks() {
        const res = await fetch(API_URL);
        const tasks = await res.json();
        renderTasks(tasks);
      }

      function formatDate(dateString) {
        if (!dateString) return "-";
        const d = new Date(dateString);
        return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(
          2,
          "0"
        )}-${String(d.getDate()).padStart(2, "0")}`;
      }

      function renderTasks(tasks) {
        const assignedFilter = filterAssigned.value;
        const statusFilter = filterStatus.value;
        const searchValue = searchInput.value.toLowerCase();
        const tbody = document.querySelector("tbody");
        tbody.innerHTML = "";

        const filtered = tasks.filter(
          (t) =>
            (!assignedFilter || t.assignedTo === assignedFilter) &&
            (!statusFilter || t.status === statusFilter) &&
            (!searchValue ||
              t.task?.toLowerCase().includes(searchValue) ||
              t.remarks?.toLowerCase().includes(searchValue))
        );

        if (!filtered.length) {
          tbody.innerHTML = `<tr><td colspan="8" style="text-align:center;">No tasks found.</td></tr>`;
          return;
        }

        filtered.forEach((t) => {
          const row = document.createElement("tr");
          row.classList.add(
            t.status === "Completed"
              ? "status-completed"
              : t.status === "Delayed"
              ? "status-delayed"
              : t.status === "Cancelled"
              ? "status-cancelled"
              : "status-inprogress"
          );

          row.innerHTML = `
      <td>${t.assignedTo}</td>
      <td>${t.task}</td>
      <td>${formatDate(t.startDate)}</td>
      <td>${formatDate(t.dueDate)}</td>
      <td>${t.status}</td>
      <td>${t.remarks || "-"}</td>
      <td>${formatDate(t.completedDate)}</td>
      <td>
        <button onclick="editTask(${t.index})">Edit</button>
        <button onclick="markCompleted(${t.index})">Mark Done</button>
      </td>
    `;
          tbody.appendChild(row);
        });
      }

      taskForm.addEventListener("submit", async (e) => {
        e.preventDefault();
        const statusValue = status.value;

        const data = {
          index: editIndex,
          assignedTo: document.getElementById("assignedTo").value,
          task: document.getElementById("task").value,
          startDate: document.getElementById("startDate").value,
          dueDate: document.getElementById("dueDate").value,
          status: document.getElementById("status").value,
          remarks: document.getElementById("remarks").value,
          completedDate:
            statusValue === "Completed" ? new Date().toISOString() : "",
        };

        await fetch(API_URL, { method: "POST", body: JSON.stringify(data) });

        taskForm.reset();
        editIndex = null;
        taskForm.querySelector("button").textContent = "Add Task";
        loadTasks();
      });

      async function editTask(index) {
        const res = await fetch(API_URL);
        const tasks = await res.json();
        const t = tasks.find((x) => x.index === index);

        assignedTo.value = t.assignedTo;
        task.value = t.task;
        startDate.value = formatDate(t.startDate);
        dueDate.value = formatDate(t.dueDate);
        status.value = t.status;
        remarks.value = t.remarks || "";

        editIndex = index;
        taskForm.querySelector("button").textContent = "Save Edit";
      }

      async function markCompleted(index) {
        await fetch(API_URL, {
          method: "POST",
          body: JSON.stringify({
            index,
            status: "Completed",
            completedDate: new Date().toISOString(),
          }),
        });

        loadTasks();
      }

      filterAssigned.addEventListener("change", loadTasks);
      filterStatus.addEventListener("change", loadTasks);
      searchInput.addEventListener("input", loadTasks);

      loadTasks();
    </script>
  </body>
</html>
